<div class="grid">
    <div class="col-12">
        <div class="card px-6 py-6">
            <p-toast></p-toast>
            <p-toolbar styleClass="mb-4" *ngIf="isSadmin() ">
                <ng-template pTemplate="left">
                    <h1 class="m-10" style="margin-right: 660px;" >Liste des clients</h1>
                    <div class="my-2">

                        <button pButton pRipple label="Ajouter" icon="pi pi-plus" class="p-button-success mr-2" (click)="openNew()"></button>
                    <!--    <button pButton pRipple label="Delete" icon="pi pi-trash" class="p-button-danger" (click)="deleteSelectedProducts()" [disabled]="!selectedProducts || !selectedProducts.length"></button>-->
                    </div>
                </ng-template>
            </p-toolbar>
            <p-toolbar styleClass="mb-4" *ngIf="isCommercant() ">
                <ng-template pTemplate="left">
                    <h1 class="m-10" style="margin-right: 660px;" >Liste des clients</h1>
                    <div class="my-2" >
                        <button pButton pRipple label="Ajouter" icon="pi pi-plus" class="p-button-success mr-2" (click)="openNew()"></button>
                    </div>
                </ng-template>
            </p-toolbar>

            <p-table #dt [value]="clients" [columns]="cols" responsiveLayout="scroll" [rows]="8" [globalFilterFields]="['firstname','lastname','email','company','domain',]" [rows]="4" [paginator]="true" [rowsPerPageOptions]="[4,8,12]" [showCurrentPageReport]="true" currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries" [(selection)]="selectedProducts" selectionMode="multiple" [rowHover]="true" dataKey="id">
                <ng-template pTemplate="caption">
                    <div class="flex flex-column md:flex-row md:justify-content-between md:align-items-center">
                        <span class="block mt-2 md:mt-0 p-input-icon-left">
                            <i class="pi pi-search"></i>
                            <input pInputText type="text" (input)="onGlobalFilter(dt, $event)" placeholder="Search..."  class="w-full sm:w-auto"/>
                        </span>
                    </div>
                </ng-template>
                <ng-template pTemplate="header">
                 
                    <tr>
                        <th>Logo</th>
                        <th>Nom</th>
                        <th>Prénom</th>
                        <th>Email</th>
                        <th>Telephone</th>
                        <th>Sociéte</th>
                        <th>Domaine</th>
                        <th>Adresse</th>
                        <th>Ville</th>
                        <th>Employées</th>
                        <th *ngIf="isSadmin()">Client de </th>
                        <th *ngIf="isAdmin()">Client de </th>
                        <th *ngIf="isSadmin()">CompteA/D</th>
                        <th *ngIf="isSadmin()"></th>
                        <th></th>
                        <th></th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-client >
                    <tr>
                        <td><img class="fit-picture"
                            [src]="'http://localhost:8098/api/v1/auth/files/' + client.logo" height="40px" width="40px"  alt="user-image" class="rounded-circle"   alt="image"></td>
                        <td>{{ client.firstname}}</td>
                        <td>{{ client.lastname}}</td>
                        <td>{{ client.email}}</td>
                        <td>{{ client.telephone}}</td>
                        <td>{{ client.company}}</td>
                        <td>{{ client.domain}}</td>
                        <td>{{ client.adresse}}</td>
                        <td>{{ client.ville}}</td>
                        <td>{{ client.nbEmployer}}</td>
                        <td *ngIf="isSadmin()">{{client.emailCommercant}}</td>
                        <td *ngIf="isAdmin()">{{client.emailCommercant}}</td>
                        <td *ngIf="isSadmin()">
                            <label  style="margin-top: 10px; margin-left: 10px;" class="switch" >
                                <p-inputSwitch (click)="updateenabled(client.id)" *ngIf="!client.enabled ; else enabled" ></p-inputSwitch>
                                <ng-template #enabled>
                                  <p-inputSwitch (click)="updatenotenabled(client.id)"   [(ngModel)]="checked"></p-inputSwitch>
                              </ng-template>
                          </label>
                        </td>
                        <td *ngIf="isSadmin()">
                            <button  pButton style="margin-right: -25px;" pRipple  icon="pi pi-check" class="p-button-rounded p-button-success " (click)="validationcompte(client.id)"></button>
                        </td>
                        <td><button pButton style="margin-right: -25px;" pRipple  icon="pi pi-pencil" class="p-button-rounded p-button-warning " (click)="editProduct(client)"></button>
                        </td>
                        <td><button pButton pRipple icon="pi pi-trash" class="p-button-rounded  p-button-danger" (click)="deleteProduct(client)"></button>
                        </td>
                    </tr>
                    <p-dialog [(visible)]="deleteProductDialog" header="Confirmer" [modal]="true" [style]="{width:'450px'}">
                        <div class="flex align-items-center justify-content-center">
                            <i class="pi pi-exclamation-triangle mr-3" style="font-size: 2rem"></i>
                            <span *ngIf="product">Etes-vous sûr que vous voulez supprimer <b>{{client.lastname}}</b>?</span>
                        </div>
                        <ng-template pTemplate="footer">
                            <button pButton pRipple icon="pi pi-times" class="p-button-text" label="No" (click)="deleteProductDialog = false"></button>
                            <button pButton pRipple icon="pi pi-check" class="p-button-text" label="Yes" (click)="onDeletclient(client.id)" ></button>
                        </ng-template>
                    </p-dialog>
                    <p-dialog [(visible)]="deleteProductsDialog" header="Confirm" [modal]="true" [style]="{width:'450px'}">
                        <div class="flex align-items-center justify-content-center">
                            <i class="pi pi-exclamation-triangle mr-3" style="font-size: 2rem"></i>
                            <span>Are you sure you want to delete selected commercant?</span>
                        </div>
                        <ng-template pTemplate="footer">
                            <button pButton pRipple icon="pi pi-times" class="p-button-text" label="No" (click)="deleteProductsDialog = false"></button>
                            <button pButton pRipple icon="pi pi-check" class="p-button-text" label="Yes" (click)="confirmDeleteSelected()"></button>
                        </ng-template>
                    </p-dialog>
                </ng-template>
            </p-table>
        </div>
        <!-- add-->
        <p-dialog [(visible)]="DialogAdd" [style]="{width: '600px'}" header="Ajouter Client" [modal]="true" class="p-fluid">
            <ng-template pTemplate="content">
                <div class="field">
                    <label for="firstname">Nom</label>
                    <input type="text" pInputText id="firstname" name="firstname" [(ngModel)]="client.firstname" required autofocus [ngClass]="{'ng-invalid ng-dirty' : submitted && !client.firstname}"/>
                    <small class="ng-dirty ng-invalid" *ngIf="submitted && !client.firstname">firstname is required.</small>
                </div>
                <div class="field">
                    <label for="lastname">Prénom</label>
                    <input type="text" pInputText id="lastname"  name="lastname" [(ngModel)]="client.lastname" required autofocus [ngClass]="{'ng-invalid ng-dirty' : submitted && !client.lastname}"/>
                    <small class="ng-dirty ng-invalid" *ngIf="submitted && !client.lastname">lastname is required.</small>
                </div>
                <div class="field">
                    <label for="email">Email</label>
                    <input type="text" pInputText id="email" name="email" [(ngModel)]="client.email"  required autofocus [ngClass]="{'ng-invalid ng-dirty' : submitted && !client.email}"/>
                    <small class="ng-dirty ng-invalid" *ngIf="submitted && !client.email">email is required.</small>
                </div>
                <div class="field">
                    <label for="telephone">Télephone</label>
                    <input type="text" pInputText id="telephone" name="telephone" [(ngModel)]="client.telephone" required autofocus [ngClass]="{'ng-invalid ng-dirty' : submitted && !client.telephone}"/>
                    <small class="ng-dirty ng-invalid" *ngIf="submitted && !client.telephone">telephone is required.</small>
                </div> <div class="field">
                    <label for="company">Sociéte</label>
                    <input type="text" pInputText id="company" name="company" [(ngModel)]="client.company" required autofocus [ngClass]="{'ng-invalid ng-dirty' : submitted && !client.company}"/>
                    <small class="ng-dirty ng-invalid" *ngIf="submitted && !client.company">company is adresse.</small>
                </div> <div class="field">
                    <label for="domain">Domaine</label>
                    <input type="text" pInputText id="domain" name="domain" [(ngModel)]="client.domain" required autofocus [ngClass]="{'ng-invalid ng-dirty' : submitted && !client.domain}"/>
                    <small class="ng-dirty ng-invalid" *ngIf="submitted && !client.domain">domain is required.</small>
                </div> 
                <div class="field">
                    <label for="adrees">Adresse</label>
                    <input type="text" pInputText id="adresse" name="adresse" [(ngModel)]="client.adresse" required autofocus [ngClass]="{'ng-invalid ng-dirty' : submitted && !client.adresse}"/>
                    <small class="ng-dirty ng-invalid" *ngIf="submitted && !client.adresse">adresse is required.</small>
                </div>
                 <div class="field">
                    <label for="ville">Ville</label>
                    <input type="text" pInputText id="ville" name="ville" [(ngModel)]="client.ville" required autofocus [ngClass]="{'ng-invalid ng-dirty' : submitted && !client.ville}"/>
                    <small class="ng-dirty ng-invalid" *ngIf="submitted && !client.ville">domain is required.</small>
                </div> 
                <div class="field">
                    <label for="pays">Pays</label>
                    <input type="text" pInputText id="pays" name="pays" [(ngModel)]="client.pays" required autofocus [ngClass]="{'ng-invalid ng-dirty' : submitted && !client.pays}"/>
                    <small class="ng-dirty ng-invalid" *ngIf="submitted && !client.domain">pays is required.</small>
                </div> 
                
                <div class="field">
                    <label for="nbEmployer">Employées</label>
                    <input type="number" pInputText id="nbEmployer" name="nbEmployer" [(ngModel)]="client.nbEmployer" required autofocus [ngClass]="{'ng-invalid ng-dirty' : submitted && !client.nbEmployer}"/>
                    <small class="ng-dirty ng-invalid" *ngIf="submitted && !client.nbEmployer">nbEmployer is required.</small>
                </div>   
            <div class="field">
                <label for="image">Logo</label>
                <input class="image" pInputText name="logo" [(ngModel)]="client.logo" type="file" class="file-upload" required  onchange="console.log(event.target.files)" (change)="onSelectedImage($event)" >
                <small class="ng-dirty ng-invalid" *ngIf="submitted && !client.logo">image is required.</small>
            </div> 
            </ng-template>
            <ng-template pTemplate="footer">
                <button pButton pRipple label="Cancel" icon="pi pi-times" class="p-button-text" (click)="hideDialog()"></button>
                <button *ngIf="isCommercant(); else Sadmin " pButton pRipple label="Save" icon="pi pi-check" class="p-button-text" (click)="saveClientCommercant($event)" ></button>
                <ng-template #Sadmin>
                    <button pButton pRipple label="Savesadmin" icon="pi pi-check" class="p-button-text" (click)="saveClient($event)"></button>
                    </ng-template>
            </ng-template>
        </p-dialog>

<!--update-->

        <p-dialog [(visible)]="productDialog" [style]="{width: '600px'}" header="Changer Client" [modal]="true" class="p-fluid">
            <ng-template pTemplate="content">
                <img [src]="'http://localhost:8098/api/v1/auth/files/' + client.logo" [alt]="client.logo" width="150" class="mt-0 mx-auto mb-5 block shadow-2" *ngIf="client.logo">
                <div class="field">
                    <label for="firstname">Nom</label>
                    <input type="text" pInputText id="firstname" name="firstname" [(ngModel)]="client.firstname" required autofocus [ngClass]="{'ng-invalid ng-dirty' : submitted && !client.firstname}"/>
                    <small class="ng-dirty ng-invalid" *ngIf="submitted && !client.firstname">firstname is required.</small>
                </div>
                <div class="field">
                    <label for="lastname">Prénom</label>
                    <input type="text" pInputText id="lastname"  name="lastname" [(ngModel)]="client.lastname" required autofocus [ngClass]="{'ng-invalid ng-dirty' : submitted && !client.lastname}"/>
                    <small class="ng-dirty ng-invalid" *ngIf="submitted && !client.lastname">lastname is required.</small>
                </div>
                <div class="field">
                    <label for="email">Email</label>
                    <input type="text" pInputText id="email" name="email" [(ngModel)]="client.email"  required autofocus [ngClass]="{'ng-invalid ng-dirty' : submitted && !client.email}"/>
                    <small class="ng-dirty ng-invalid" *ngIf="submitted && !client.email">email is required.</small>
                </div>
                <div class="field">
                    <label for="telephone">Télephone</label>
                    <input type="text" pInputText id="telephone" name="telephone" [(ngModel)]="client.telephone" required autofocus [ngClass]="{'ng-invalid ng-dirty' : submitted && !client.telephone}"/>
                    <small class="ng-dirty ng-invalid" *ngIf="submitted && !client.telephone">telephone is required.</small>
                </div> <div class="field">
                    <label for="adresse">Sociéte</label>
                    <input type="text" pInputText id="company" name="company" [(ngModel)]="client.company" required autofocus [ngClass]="{'ng-invalid ng-dirty' : submitted && !client.company}"/>
                    <small class="ng-dirty ng-invalid" *ngIf="submitted && !client.company">adresse is adresse.</small>
                </div> <div class="field">
                    <label for="ville">Domaine</label>
                    <input type="text" pInputText id="domain" name="domain" [(ngModel)]="client.domain" required autofocus [ngClass]="{'ng-invalid ng-dirty' : submitted && !client.domain}"/>
                    <small class="ng-dirty ng-invalid" *ngIf="submitted && !client.domain">ville is required.</small>
                </div> 
                <div class="field">
                    <label for="adrees">Adresse</label>
                    <input type="text" pInputText id="adresse" name="adresse" [(ngModel)]="client.adresse" required autofocus [ngClass]="{'ng-invalid ng-dirty' : submitted && !client.adresse}"/>
                    <small class="ng-dirty ng-invalid" *ngIf="submitted && !client.adresse">adresse is required.</small>
                </div>
                 <div class="field">
                    <label for="ville">Ville</label>
                    <input type="text" pInputText id="ville" name="ville" [(ngModel)]="client.ville" required autofocus [ngClass]="{'ng-invalid ng-dirty' : submitted && !client.ville}"/>
                    <small class="ng-dirty ng-invalid" *ngIf="submitted && !client.ville">domain is required.</small>
                </div> 
                <div class="field">
                    <label for="pays">Pays</label>
                    <input type="text" pInputText id="pays" name="pays" [(ngModel)]="client.pays" required autofocus [ngClass]="{'ng-invalid ng-dirty' : submitted && !client.pays}"/>
                    <small class="ng-dirty ng-invalid" *ngIf="submitted && !client.domain">pays is required.</small>
                </div> 
                <div class="field">
                    <label for="ville">Employées</label>
                    <input type="text" pInputText id="nbEmployer" name="nbEmployer" [(ngModel)]="client.nbEmployer" required autofocus [ngClass]="{'ng-invalid ng-dirty' : submitted && !client.nbEmployer}"/>
                    <small class="ng-dirty ng-invalid" *ngIf="submitted && !client.nbEmployer">ville is required.</small>
                </div> 
                 
            <div class="field">
                <label for="image">Logo</label>
                <input class="image" pInputText name="logo" [(ngModel)]="client.logo" type="file" class="file-upload" required  onchange="console.log(event.target.files)" (change)="onSelectedImage($event)" >
                <small class="ng-dirty ng-invalid" *ngIf="submitted && !client.logo">image is required.</small>
            </div> 
               
            </ng-template>

            <ng-template pTemplate="footer">
                <button pButton pRipple label="Cancel" icon="pi pi-times" class="p-button-text" (click)="hideDialog()"></button>
                <button *ngIf="isCommercant(); else Sadmin " pButton pRipple label="edit" icon="pi pi-check" class="p-button-text" (click)="update($event)"  ></button>
                <ng-template #Sadmin>
                    <button pButton pRipple label="editsadmin" icon="pi pi-check" class="p-button-text" (click)="updateSadmin($event)" ></button>
                    </ng-template>
            </ng-template>
        </p-dialog>
    </div>
</div>
